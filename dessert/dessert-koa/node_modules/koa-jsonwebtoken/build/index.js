module.exports=function(e){function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}var t={};return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=4)}([function(e,r){e.exports=require("es6-promisify")},function(e,r){e.exports=require("jsonwebtoken")},function(e,r){e.exports=require("koa-unless")},function(e,r){e.exports=require("util")},function(e,r,t){"use strict";function o(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function o(n,i){try{var s=r[n](i),u=s.value}catch(e){return void t(e)}return s.done?void e(u):Promise.resolve(u).then(function(e){o("next",e)},function(e){o("throw",e)})}return o("next")})}}Object.defineProperty(r,"__esModule",{value:!0});var n=t(1),i=t.n(n),s=t(2),u=t.n(s),c=t(3),f=(t.n(c),t(0)),a=t.n(f);t.o(n,"verify")&&t.d(r,"verify",function(){return n.verify}),t.o(n,"decode")&&t.d(r,"decode",function(){return n.decode}),t.o(n,"sign")&&t.d(r,"sign",function(){return n.sign});const d=a()(n.verify,i.a);r.default=((e={})=>{if(!e.secret)throw new Error("secret must be specified");if(!e.extractToken||!t.i(c.isFunction)(e.extractToken))throw new Error("token extraction strategy must be specified and should be a function");if(e.checkRevoked&&!t.i(c.isFunction)(e.checkRevoked))throw new Error("token revokation check must be a function");if(e.doRefresh&&!t.i(c.isFunction)(e.doRefresh))throw new Error("token refresh strategy must be specified and should be a function");const{secret,key="user",extractToken,checkRevoked=false,doRefresh=false}=e,r=(()=>{var r=o(function*(r,t){try{const o=extractToken(r,e),n=yield d(o,secret,e);checkRevoked&&(yield checkRevoked(n,e)),r.state=r.state||{},r.state[key]=n}catch(o){if("jwt expired"===o.message&&doRefresh){try{const t=h(r,e,!0),o=extractToken(r,e),n=yield d(o,secret,{ignoreExpiration:!0});yield doRefresh(r,e,t,n),r.state=r.state||{},r.state[key]=n}catch(e){r.throw(401,`Invalid token - ${e.message}`)}yield t()}else r.throw(401,`Invalid token - ${o.message}`)}yield t()});return function(e,t){return r.apply(this,arguments)}})();return r.unless=u.a,r});const h=(e,r,t=false)=>{if(t){if(r.refreshCookie&&e.cookies.get(r.refreshCookie))return e.cookies.get(r.refreshCookie);throw new Error(`the refresh cookie was not found
`)}if(r.cookie&&e.cookies.get(r.cookie))return e.cookies.get(r.cookie);throw new Error(`the specified cookie was not found
`)};r.fromCookies=h;const l=(e,r)=>{if(!e.header||!e.header.authorization)throw new Error(`can't find authorization header`);const t=e.header.authorization.split(" ");if(2===t.length){const e=t[0],r=t[1];if(/^Bearer$/i.test(e))return r;throw new Error(`Bad Authorization header format. Format is "Authorization: Bearer token"
`)}throw new Error(`Bad Authorization header format. Format is "Authorization: Bearer token"
`)};r.fromAuthorizationHeader=l}]);
//# sourceMappingURL=./build/index.js.map